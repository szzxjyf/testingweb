# RRI 数据综合处理系统 - 使用说明

## 系统概述

本系统用于处理和统计员工的SMT、Meeting和Deal数据，按照Staff ID和月份进行综合统计，生成可视化报表。

---

## 文件要求

系统需要上传3个CSV文件，每个文件都有特定的列名要求和处理逻辑。

### 文件1：SMT数据文件

#### 必需列名
- **Month ID**: 月份标识，格式为6位数字（如"202501"表示2025年1月）
- **SMT Type**: SMT类型
- **SMT Orginator**: SMT发起人信息（包含Staff ID）

#### 数据要求
- `SMT Orginator` 列的前8位数字作为Staff ID
- 只统计以下三种类型：
  - Cross-sell
  - Lead Referral
  - Testimonial/Compliment

#### 计算逻辑
按 **Staff ID** 和 **Month ID** 分组，统计每种类型的行数：
- **Cross-sell数量** = SMT Type为"Cross-sell"的记录数
- **Lead Referral数量** = SMT Type为"Lead Referral"的记录数
- **Testimonial数量** = SMT Type为"Testimonial/Compliment"的记录数

#### 示例
```csv
Month ID,SMT Type,SMT Orginator
202501,Cross-sell,43123456/ABC CDSD
202501,Lead Referral,87654321/DEF EFGH
202501,Testimonial/Compliment,11223344/GHI IJKL
```

---

### 文件2：Meeting数据文件

#### 必需列名
- **Attendee Employee ID**: 参会者员工ID（Staff ID）
- **Created By Employee ID**: 创建者员工ID（Staff ID）
- **Year & Month**: 年月标识，格式为5位数字（如"20253"表示2025年3月）
- **Meeting Type**: 会议类型

#### 数据要求
- Staff ID可能是数字或文本格式，系统会统一转换为文本
- `Year & Month` 的前4位是年份，剩余位数是月份
  - 例如："20253" → "202503"
  - 例如："202512" → "202512"

#### 计算逻辑
按 **Staff ID** 和 **月份** 分组，分别统计两种类型：

1. **Client Meeting (Attendee)**: 
   - 筛选条件：Meeting Type = "Client Meeting"
   - 统计维度：按 **Attendee Employee ID** 统计
   - 计算方式：符合条件的记录行数

2. **Service Review (Creator)**:
   - 筛选条件：Meeting Type = "Service Review"
   - 统计维度：按 **Created By Employee ID** 统计
   - 计算方式：符合条件的记录行数

#### 示例
```csv
Attendee Employee ID,Created By Employee ID,Year & Month,Meeting Type
12345678,87654321,202501,Client Meeting
87654321,11223344,202501,Service Review
```

---

### 文件3：Deal数据文件

#### 必需列名
- **Deal TL PS ID**: Deal负责人的Staff ID
- **Month&Year**: 月份年份，格式为5位数字（如"20253"）
- **Staff Team Country**: 员工团队所属国家
- **Domestic Contribution**: 国内贡献度（数值）
- **Deal Category_Alt**: Deal分类
- **EBV (USD000)**: 经济利益价值（单位：千美元）

#### 数据要求
- `Deal TL PS ID` 作为Staff ID
- `Month&Year` 格式处理同Meeting文件

#### 筛选条件（必须同时满足）
1. **Staff Team Country** = "China" （严格匹配）
2. **Domestic Contribution** = 100 （数值精确匹配）
3. **Deal Category_Alt** = "Won" （严格匹配）

#### 计算逻辑
按 **Staff ID** 和 **月份** 分组，对符合筛选条件的记录进行统计：
- **Deal数量** = 符合条件的记录行数
- **EBV总额** = 符合条件记录的 `EBV (USD000)` 字段求和

#### 示例
```csv
Deal TL PS ID,Month&Year,Staff Team Country,Domestic Contribution,Deal Category_Alt,EBV (USD000)
12345678,202501,China,100,Won,150.5
87654321,202501,China,100,Won,200.3
11223344,202501,India,100,Won,75.8  # 不符合条件（国家不是China）
```

---

## 数据合并逻辑

系统将三个文件的数据按照 **Staff ID + 月份** 的组合进行合并：

1. 提取每个文件中的 Staff ID 和月份作为主键
2. 相同 Staff ID + 月份 的数据合并为一行
3. 如果某个员工在某月份只在部分文件中出现，其他字段填充为0

### 合并示例

**员工43123456在202501月**:
- SMT文件：Cross-sell=2, Lead Referral=1, Testimonial=0
- Meeting文件：Client Meeting=3, Service Review=1
- Deal文件：Deal数量=2, EBV总额=350.5

**合并结果**:
```
Staff ID: 43123456
月份: 202501
Cross-sell: 2
Lead Referral: 1
Testimonial/Compliment: 0
Client Meeting: 3
Service Review: 1
Deal数量: 2
EBV总额: 350.5
```

---

## 输出结果说明

### 1. 统计卡片（7个）
显示所有数据的总计：
- Cross-sell 总数
- Lead Referral 总数
- Testimonial/Compliment 总数
- Client Meeting 总数
- Service Review 总数
- Deal 总数
- EBV 总额

### 2. 数据趋势图
- 7个可切换的折线图标签
- 按月份聚合所有员工的数据
- 显示每个月各项指标的总和趋势
- 点击标签切换查看不同指标

### 3. 详细数据表格
显示前20条记录，包含以下字段：
- Staff ID（员工ID）
- 月份
- Cross-sell（数量）
- Lead Referral（数量）
- Testimonial/Compliment（数量）
- Client Meeting（作为参会者，数量）
- Service Review（作为创建者，数量）
- Deal数量
- EBV总额（USD000）

### 4. 数据导出
- 可按月份筛选导出
- 导出包含**全部**数据（不受页面显示20条的限制）
- 导出格式为CSV文件

---

## 使用步骤

### 步骤1：准备数据文件
确保三个CSV文件包含必需的列名，数据格式正确。

### 步骤2：上传文件
1. 点击"选择SMT CSV文件"上传第一个文件
2. 点击"选择Meeting CSV文件"上传第二个文件
3. 点击"选择Deal CSV文件"上传第三个文件
4. 三个文件都上传后，"开始处理数据"按钮会激活

### 步骤3：处理数据
1. 点击"开始处理数据"按钮
2. 系统会显示处理过程日志
3. 处理完成后自动显示结果

### 步骤4：查看结果
1. 顶部查看统计卡片总览
2. 点击图表标签切换查看不同指标的趋势
3. 下方查看详细数据表格（前20条）

### 步骤5：导出数据
1. 选择需要导出的月份（或全选）
2. 点击"导出选中月份的数据"按钮
3. 下载CSV文件

---

## 常见问题

### Q1: Staff ID格式不一致怎么办？
**A**: 系统会自动处理：
- SMT文件：提取Originator前8位数字
- Meeting文件：自动转换为文本格式
- Deal文件：自动转换为文本格式

### Q2: 月份格式不一致怎么办？
**A**: 系统会自动标准化：
- 5位数字"20253" → "202503"
- 6位数字"202501" → "202501"

### Q3: 为什么某些员工的某些指标是0？
**A**: 这表示该员工在该月份的该项指标没有数据。系统会为缺失的指标填充0。

### Q4: Deal数据为什么比原始文件少很多？
**A**: Deal数据有严格的筛选条件：
- 必须是China团队
- Domestic Contribution必须等于100
- Deal Category必须是Won
不符合任一条件的记录会被过滤掉。

### Q5: 页面只显示20条，完整数据在哪里？
**A**: 使用"导出选中月份的数据"功能，导出的CSV文件包含全部数据。

### Q6: 如何只导出特定月份的数据？
**A**: 在月份复选框中取消不需要的月份，只勾选需要的月份，然后点击导出。

---

## 性能说明

- 系统采用批量处理和异步渲染技术
- 每100行数据输出一次进度日志
- 页面只渲染前20条记录，减轻浏览器负担
- 适合处理数千至数万行的数据文件

---

## 技术特性

- ✅ 纯HTML/CSS/JavaScript，无需安装
- ✅ 无外部依赖库
- ✅ 本地处理，数据不上传服务器
- ✅ 支持大文件处理
- ✅ 自适应高清屏幕
- ✅ 响应式设计

---

## 联系与支持

如有问题或建议，请联系系统管理员。

**版本**: 1.0  
**最后更新**: 2025-01-23

